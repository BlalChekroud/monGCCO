            <!-- Body du modal -->
            <div class="modal-body">
                {# <div id="printableArea" class="explanation"> #}
                    <!-- Détails de la campagne -->
                    {# <h6 class="mt-4"><i class="bi bi-info-circle-fill text-info"></i> Détails de la campagne :</h6> #}
                    <table class="table table-hover table-striped">
                        <tr><td><strong>Nom :</strong></td><td>{{ counting_campaign.campaignName }}</td></tr>
                        <tr><td><strong>Date de début :</strong></td><td>{{ counting_campaign.startDate ? counting_campaign.startDate|date('d-m-Y H:i:s') : '' }}</td></tr>
                        <tr><td><strong>Date de fin :</strong></td><td>{{ counting_campaign.endDate ? counting_campaign.endDate|date('d-m-Y H:i:s') : '' }}</td></tr>
                        <tr><td><strong>État :</strong></td><td>{{ counting_campaign.campaignStatus }}</td></tr>
                        <tr><td><strong>Créé le :</strong></td><td>{{ counting_campaign.createdAt ? counting_campaign.createdAt|date('d-m-Y H:i:s') : '' }}</td></tr>
                        <tr><td><strong>Dernière mise à jour :</strong></td><td>{{ counting_campaign.updatedAt ? counting_campaign.updatedAt|date('d-m-Y H:i:s') : '' }}</td></tr>
                        <tr><td><strong>Description :</strong></td><td>{{ counting_campaign.description }}</td></tr>
                        <tr><td><strong>Créé par :</strong></td><td>{{ counting_campaign.createdBy.getEmail }}</td></tr>
                    </table>

                    <!-- Statistiques de la campagne -->
                    <h6 class="mt-4"><i class="bi bi-bar-chart-line-fill"></i> Statistiques de la campagne :</h6>
                    <table class="table table-hover table-bordered table-striped table-sm">
                        <thead class="table-dark">
                            <tr>
                                <th>Statistique</th>
                                <th>Valeur</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><i class="bi bi-geo-alt-fill text-warning"></i> Nombre de sites impliqués</td>
                                <td><span class="badge bg-info">{{ counting_campaign.siteAgentsGroups|length }}</span></td>
                            </tr>
                            <tr>
                                <td><i class="bi bi-person-fill text-success"></i> Nombre total d'agents participants</td>
                                <td>
                                    <span class="badge bg-success">{{ counting_campaign.getTotalAgents() }}</span>
                                </td>
                            </tr>
                            <tr>
                                <td><i class="bi bi-file-earmark-bar-graph-fill text-primary"></i> Nombre total de collectes</td>
                                <td>
                                    <span class="badge bg-primary">{{ counting_campaign.getTotalCollects() }}</span>
                                </td>
                            </tr>
                            <tr>
                                <td><i class="bi bi-cloud-sun-fill"></i> Moyenne des conditions météorologiques</td>
                                <td>
                                    {# <span class="badge bg-warning">{{ counting_campaign.getAverageWeatherCondition() }}</span> #}
                                    <ul>
                                        <li>Météo : {{ counting_campaign.getAverageEnvironmentalConditions.most_common_weather }}</li>
                                        <li>Glace : {{ counting_campaign.getAverageEnvironmentalConditions.most_common_ice }}</li>
                                        <li>Marée : {{ counting_campaign.getAverageEnvironmentalConditions.most_common_tidal }}</li>
                                        <li>Eaux : {{ counting_campaign.getAverageEnvironmentalConditions.most_common_water }}</li>
                                        <li>Pourcentage de perturbation : {{ counting_campaign.getAverageEnvironmentalConditions.disturbed_percentage }}%</li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td><i class="bi bi-list-ol"></i> Méthodes de collecte utilisées</td>
                                <td>
                                    {# {{ counting_campaign.getCollectionMethods()|join(', ') }} #}
                                    {{ counting_campaign.getMethodsUsed()|join('; ') }}
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Sites et collectes -->
                    <h6 class="mt-4"><i class="bi bi-geo-alt-fill"></i> Sites et collectes :</h6>
                    {% if counting_campaign.siteAgentsGroups|length > 0 %}
                        {% set totalCountsPerSite = counting_campaign.getTotalCountsPerSite() %}
                        {% for siteAgentsGroup in counting_campaign.siteAgentsGroups %}
                            {% set site = siteAgentsGroup.siteCollection %}
                            <div class="site-section mb-4">
                                <h5 class="mb-3">
                                    <i class="bi bi-geo-alt-fill text-warning"></i> Site : {{ site.siteName }} ({{ site.city.name }} / {{ site.city.region.name }})
                                </h5>
                                <!-- Active Table -->
                                <table class="table table-borderless">
                                    <thead class="table-dark">
                                        <tr>
                                            {# <th scope="col">#</th> #}
                                            <th scope="col"><i class="bi bi-people-fill"></i> Groupes d'agents associés</th>
                                            <th scope="col"><i class="bi bi-file-earmark-bar-graph-fill"></i> Total de comptages d'oiseaux</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        {# <th scope="row">{{ loop.index }}</th> #}
                                        <td>
                                            {% if siteAgentsGroup.agentsGroup|length > 0 %}
                                            <ul>
                                                {% for group in siteAgentsGroup.agentsGroup %}
                                                    <li>{{ group.groupName }}; (Chef: {{ group.leader.getEmail }})</li>
                                                    <ul>
                                                        {% for agent in group.groupMember %}
                                                            <li>{{ agent.getEmail }} ({{ agent.name }} {{ agent.lastName }})</li>
                                                        {% else %}
                                                            <li>Aucun agent assigné</li>
                                                        {% endfor %}
                                                    </ul>
                                                {% endfor %}
                                            </ul>
                                        {% else %}
                                            <p class="text-muted">Aucun groupe trouvé pour ce site.</p>
                                        {% endif %}
                                        </td>
                                        <td class="d-flex justify-content-center"><span class="badge bg-info"><h5>{{ totalCountsPerSite[site.id] ?? 0 }}</h5></span></td>
                                    </tr>
                                    </tbody>
                                </table>
                                <!-- End Tables without borders -->

                                <!-- Collectes de ce site -->
                                {% for collect in site.collectedData %}
                                    {% if collect.countingCampaign == counting_campaign %}
                                        <h6 class="mt-3"><i class="bi bi-file-earmark-bar-graph-fill"></i> Collecte no: {{ collect.id }} - Collecteur: {{ collect.createdBy.getEmail }}</h6>
                                        <table class="table table-bordered table-sm">
                                            <thead class="table-dark">
                                                <tr>
                                                    <th>Comptage</th>
                                                    <th>Conditions Environnementales</th>
                                                    <th>Espèces d'oiseaux observées</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <!-- Collecte -->
                                                    <td>
                                                        <ul>
                                                            <li><strong>Type:</strong> {{ collect.countType.label }}</li>
                                                            <li><strong>Qualité:</strong> {{ collect.quality.label }}</li>
                                                        </ul>
                                                        
                                                        <span><i class="bi bi-list-ol"></i><strong> Méthode(s):</strong>
                                                            <ul>
                                                                {% for method in collect.method %}
                                                                    <li>{{ method.label }}</li>
                                                                {% else %}
                                                                    <span class="text-muted">Aucune méthode</span>
                                                                {% endfor %}
                                                            </ul>
                                                        </span>
                                                    </td>
                                                    <!-- Conditions Environnementales -->
                                                    <td>
                                                        <ul>
                                                            <li><strong>Disturbé(e):</strong> {{ collect.environmentalConditions.disturbed }}</li>
                                                            <li><strong>Météo:</strong> {{ collect.environmentalConditions.weather.label }}</li>
                                                            <li><strong>Glace:</strong> {{ collect.environmentalConditions.ice.label }}</li>
                                                            <li><strong>Marée:</strong> {{ collect.environmentalConditions.tidal.label }}</li>
                                                            <li><strong>Eaux:</strong> {{ collect.environmentalConditions.water.label }}</li>
                                                        </ul>
                                                    </td>
                                                    <!-- Espèces d'oiseaux observées -->
                                                    <td>
                                                        <ul>
                                                            {% if collect.birdSpeciesCounts|length > 0 %}
                                                                {% for species, count in collect.getCountBySpecies %}
                                                                    <li>{{ species }}: {{ count }}</li>
                                                                {% else %}
                                                                    <li class="text-muted">Aucune espèce observée</li>
                                                                {% endfor %}
                                                                <strong>Total:</strong> <span class="badge bg-success">{{ collect.totalCount }}</span>
                                                            {% else %}
                                                                <li class="text-muted">Aucune espèce observée</li>
                                                            {% endif %}
                                                        </ul>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">Aucun site trouvé pour cette campagne.</p>
                    {% endif %}

                    <!-- Nombre total compté pour chaque espèce -->
                    <h6 class="mt-4"><i class="bi bi-bar-chart-line-fill"></i> Nombre total compté pour chaque espèce :</h6>
                    <table class="table table-hover table-bordered table-striped table-sm">
                        <thead class="table-dark">
                            <tr>
                                <th>Espèce</th>
                                <th>Nombre total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for species, count in counting_campaign.getTotalCountBySpecies %}
                                <tr>
                                    <td><i class="bi bi-info-circle-fill text-primary"></i> {{ species }}</td>
                                    <td><span class="badge bg-success">{{ count }}</span></td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="2" class="text-center text-muted">
                                        <i class="bi bi-exclamation-circle"></i> Aucune espèce observée dans cette campagne
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    <!-- Total général -->
                    <div class="alert alert-primary mt-4">
                        <h6 class="mb-0">
                            <i class="bi bi-bar-chart-fill"></i> Total général des comptages dans la campagne :
                        </h6>
                        <p class="fw-bold fs-4">{{ counting_campaign.getTotalCountsCampaign }}</p>
                    </div>

                {# </div> #}
            </div>

                                <!-- Footer du modal -->
                                <div class="modal-footer d-flex justify-content-center">
                                    <button type="button" class="btn btn-secondary bi bi-x-lg" data-bs-dismiss="modal" title="Fermer"></button>
                                    <button onclick="window.print()" class="btn btn-secondary bi bi-printer" title="Imprimer"></button>
                                    {% if counting_campaign.campaignStatus != statusSuspended and counting_campaign.campaignStatus != statusClosed %}
                                        <a href="{{ path('app_counting_campaign_suspend', {'id': counting_campaign.id}) }}" class="btn btn-warning">Mettre en suspens</a>
                                    {% elseif counting_campaign.campaignStatus == statusSuspended %}
                                        <a href="{{ path('app_counting_campaign_suspend', {'id': counting_campaign.id}) }}" class="btn btn-warning" title="Mettre fin au suspension de la campagne">Reprendre</a>
                                    {% endif %}
                                    {% if counting_campaign.campaignStatus == statusFinished %}
                                        <a href="{{ path('app_counting_campaign_close', {'id': counting_campaign.id}) }}" class="btn btn-primary">Clôturer la campagne</a>
                                    {% endif %}
                                </div>
